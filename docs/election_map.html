<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Electoral Power 3D Map</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            /* Slate 900 */
            color: #e2e8f0;
            overflow: hidden;
            /* Prevent scrolling */
        }

        /* 3D Scene Container */
        .scene-container {
            perspective: 1200px;
            overflow: visible;
        }

        /* The Rotating World */
        .world {
            transform-style: preserve-3d;
            transition: transform 0.1s linear;
            will-change: transform;
        }

        /* Grid Layout */
        .map-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 1.5rem;
            width: 800px;
            height: 500px;
            margin: 0 auto;
            transform-style: preserve-3d;
        }

        /* Mobile Responsive Scaling */
        @media (max-width: 850px) {
            .map-grid {
                transform: scale(0.8);
                transform-origin: center top;
                margin-top: 1rem;
            }

            /* Hide Desktop Controls on Mobile */
            .controls-panel {
                display: none !important;
            }

            /* Mobile Header Styles */
            #mobile-header {
                pointer-events: auto;
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(51, 65, 85, 0.5);
                padding: 1rem;
                transition: all 0.3s ease;
                max-height: 100vh;
                overflow: hidden;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                z-index: 50;
                cursor: pointer;
            }

            #mobile-header.collapsed {
                max-height: 80px; /* Approx height for just title */
            }

            #mobile-header.collapsed .header-content {
                opacity: 0;
                pointer-events: none;
            }
            
            #mobile-header .header-content {
                transition: opacity 0.3s ease;
                opacity: 1;
            }

            /* Mobile Summary Styles */
            #mobile-summary-trigger {
                display: flex !important;
            }

            #summary-container {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                max-height: 80vh;
                transform: translateY(100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border-radius: 1.5rem 1.5rem 0 0;
                border: 1px solid rgba(51, 65, 85, 0.5);
                border-bottom: none;
                z-index: 60;
            }

            #summary-container.open {
                transform: translateY(0);
            }

            /* Adjust Legend for Mobile Header */
            .desktop-legend {
                display: none;
            }
        }

        @media (min-width: 851px) {
            #mobile-header {
                pointer-events: none; /* Let clicks pass through on desktop */
                background: transparent;
                border: none;
                padding: 1.5rem;
            }
            
            #mobile-summary-trigger {
                display: none !important;
            }
            
            .mobile-only-legend {
                display: none;
            }
        }

        @media (max-width: 650px) {
            .map-grid {
                transform: scale(0.6);
                transform-origin: center top;
                margin-top: 6rem; /* More space for header */
            }
        }

        @media (max-width: 480px) {
            .map-grid {
                transform: scale(0.45);
                transform-origin: center top;
                margin-top: 5rem;
            }
        }

        /* Individual State Cell */
        .state-cell {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        /* The 3D Bar (Prism) */
        .bar {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Faces of the Prism */
        .face {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backface-visibility: hidden;
        }

        /* Top Face (The State Label) */
        .face.top {
            width: 100%;
            height: 100%;
            transform: translateZ(var(--height));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.8rem;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s;
        }

        .face.top span {
            pointer-events: none;
        }

        /* Side Faces with shading */
        .face.front {
            width: 100%;
            height: var(--height);
            transform: rotateX(-90deg) translateZ(25px);
            bottom: 0;
            transform-origin: bottom;
            filter: brightness(0.8);
        }

        .face.back {
            width: 100%;
            height: var(--height);
            transform: rotateX(-90deg) translateZ(-25px) rotateY(180deg);
            bottom: 0;
            transform-origin: bottom;
            filter: brightness(0.8);
        }

        .face.left {
            width: var(--height);
            height: 100%;
            transform: rotateY(-90deg) translateZ(25px);
            left: 0;
            transform-origin: left;
            filter: brightness(0.6);
        }

        .face.right {
            width: var(--height);
            height: 100%;
            transform: rotateY(90deg) translateZ(25px);
            rotateY(0deg);
            right: 0;
            transform-origin: right;
            filter: brightness(0.6);
        }

        /* Base Shadow */
        .shadow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            transform: translateZ(0.1px);
            filter: blur(4px);
        }

        /* Hover Effect */
        .state-cell:hover .face.top {
            background-color: #ffffff !important;
            color: #000;
        }

        .state-cell:hover .bar {
            transform: translateZ(10px);
            /* Pop up slightly */
        }

        /* Tooltip */
        #tooltip {
            pointer-events: none;
            z-index: 50;
            transition: opacity 0.2s, transform 0.1s;
            backdrop-filter: blur(8px);
        }

        /* Legend Gradient */
        .gradient-legend {
            background: linear-gradient(to right, #3b82f6, #8b5cf6, #f43f5e, #fbbf24);
        }

        /* Floating Controls */
        .controls-panel {
            backdrop-filter: blur(12px);
            transition: height 0.3s ease, opacity 0.3s ease;
        }

        .collapsed-controls {
            height: 56px;
            /* Minimized Height */
            overflow: hidden;
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Vote Bar in Tooltip */
        .vote-bar-bg {
            background-color: #334155;
            height: 6px;
            width: 100%;
            border-radius: 3px;
            overflow: hidden;
            display: flex;
        }

        .vote-bar-dem {
            background-color: #3b82f6;
            height: 100%;
        }

        .vote-bar-rep {
            background-color: #ef4444;
            height: 100%;
        }

        .vote-bar-oth {
            background-color: #94a3b8;
            height: 100%;
        }

        /* Summary Table Styles */
        .summary-table th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.65rem;
            letter-spacing: 0.05em;
            padding-bottom: 0.5rem;
            color: #94a3b8;
        }

        .summary-table td {
            padding: 0.4rem 0;
            font-family: monospace;
            font-weight: 600;
            font-size: 0.9rem;
        }
    </style>
    <style>
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .pointer-events-none {
            pointer-events: none
        }

        .pointer-events-auto {
            pointer-events: auto
        }

        .fixed {
            position: fixed
        }

        .absolute {
            position: absolute
        }

        .relative {
            position: relative
        }

        .bottom-10 {
            bottom: 2.5rem
        }

        .bottom-6 {
            bottom: 1.5rem
        }

        .left-0 {
            left: 0px
        }

        .left-1\/2 {
            left: 50%
        }

        .left-6 {
            left: 1.5rem
        }

        .right-6 {
            right: 1.5rem
        }

        .top-0 {
            top: 0px
        }

        .z-0 {
            z-index: 0
        }

        .z-10 {
            z-index: 10
        }

        .z-40 {
            z-index: 40
        }

        .mb-1 {
            margin-bottom: 0.25rem
        }

        .mb-2 {
            margin-bottom: 0.5rem
        }

        .mb-3 {
            margin-bottom: 0.75rem
        }

        .ml-1 {
            margin-left: 0.25rem
        }

        .mt-1 {
            margin-top: 0.25rem
        }

        .mt-2 {
            margin-top: 0.5rem
        }

        .mt-3 {
            margin-top: 0.75rem
        }

        .mt-4 {
            margin-top: 1rem
        }

        .inline-block {
            display: inline-block
        }

        .flex {
            display: flex
        }

        .hidden {
            display: none
        }

        .h-2 {
            height: 0.5rem
        }

        .h-3 {
            height: 0.75rem
        }

        .h-\[56px\] {
            height: 56px
        }

        .h-\[600px\] {
            height: 600px
        }

        .h-screen {
            height: 100vh
        }

        .w-2 {
            width: 0.5rem
        }

        .w-56 {
            width: 14rem
        }

        .w-64 {
            width: 16rem
        }

        .w-\[800px\] {
            width: 800px
        }

        .w-full {
            width: 100%
        }

        .w-screen {
            width: 100vw
        }

        .min-w-\[180px\] {
            min-width: 180px
        }

        .max-w-lg {
            max-width: 32rem
        }

        .flex-grow {
            flex-grow: 1
        }

        .border-collapse {
            border-collapse: collapse
        }

        .-translate-x-1\/2 {
            --tw-translate-x: -50%;
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        @keyframes pulse {
            50% {
                opacity: .5
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite
        }

        .cursor-grab {
            cursor: grab
        }

        .cursor-pointer {
            cursor: pointer
        }

        .flex-col {
            flex-direction: column
        }

        .items-start {
            align-items: flex-start
        }

        .items-center {
            align-items: center
        }

        .items-baseline {
            align-items: baseline
        }

        .justify-center {
            justify-content: center
        }

        .justify-between {
            justify-content: space-between
        }

        .gap-2 {
            gap: 0.5rem
        }

        .gap-4 {
            gap: 1rem
        }

        .space-y-1> :not([hidden])~ :not([hidden]) {
            --tw-space-y-reverse: 0;
            margin-top: calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));
            margin-bottom: calc(0.25rem * var(--tw-space-y-reverse))
        }

        .overflow-hidden {
            overflow: hidden
        }

        .rounded {
            border-radius: 0.25rem
        }

        .rounded-full {
            border-radius: 9999px
        }

        .rounded-lg {
            border-radius: 0.5rem
        }

        .rounded-xl {
            border-radius: 0.75rem
        }

        .border {
            border-width: 1px
        }

        .border-b {
            border-bottom-width: 1px
        }

        .border-t {
            border-top-width: 1px
        }

        .border-emerald-500 {
            --tw-border-opacity: 1;
            border-color: rgb(16 185 129 / var(--tw-border-opacity, 1))
        }

        .border-slate-600 {
            --tw-border-opacity: 1;
            border-color: rgb(71 85 105 / var(--tw-border-opacity, 1))
        }

        .border-slate-700 {
            --tw-border-opacity: 1;
            border-color: rgb(51 65 85 / var(--tw-border-opacity, 1))
        }

        .border-slate-700\/50 {
            border-color: rgb(51 65 85 / 0.5)
        }

        .border-slate-800\/50 {
            border-color: rgb(30 41 59 / 0.5)
        }

        .bg-blue-500 {
            --tw-bg-opacity: 1;
            background-color: rgb(59 130 246 / var(--tw-bg-opacity, 1))
        }

        .bg-emerald-600 {
            --tw-bg-opacity: 1;
            background-color: rgb(5 150 105 / var(--tw-bg-opacity, 1))
        }

        .bg-red-500 {
            --tw-bg-opacity: 1;
            background-color: rgb(239 68 68 / var(--tw-bg-opacity, 1))
        }

        .bg-slate-700 {
            --tw-bg-opacity: 1;
            background-color: rgb(51 65 85 / var(--tw-bg-opacity, 1))
        }

        .bg-slate-800\/80 {
            background-color: rgb(30 41 59 / 0.8)
        }

        .bg-slate-900\/80 {
            background-color: rgb(15 23 42 / 0.8)
        }

        .bg-slate-900\/95 {
            background-color: rgb(15 23 42 / 0.95)
        }

        .bg-gradient-to-r {
            background-image: linear-gradient(to right, var(--tw-gradient-stops))
        }

        .from-blue-400 {
            --tw-gradient-from: #60a5fa var(--tw-gradient-from-position);
            --tw-gradient-to: rgb(96 165 250 / 0) var(--tw-gradient-to-position);
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
        }

        .to-rose-400 {
            --tw-gradient-to: #fb7185 var(--tw-gradient-to-position)
        }

        .bg-clip-text {
            -webkit-background-clip: text;
            background-clip: text
        }

        .p-3 {
            padding: 0.75rem
        }

        .p-4 {
            padding: 1rem
        }

        .p-5 {
            padding: 1.25rem
        }

        .p-6 {
            padding: 1.5rem
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem
        }

        .pb-1 {
            padding-bottom: 0.25rem
        }

        .pb-2 {
            padding-bottom: 0.5rem
        }

        .pb-4 {
            padding-bottom: 1rem
        }

        .pr-3 {
            padding-right: 0.75rem
        }

        .pt-2 {
            padding-top: 0.5rem
        }

        .text-left {
            text-align: left
        }

        .text-right {
            text-align: right
        }

        .font-mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace
        }

        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem
        }

        .text-\[10px\] {
            font-size: 10px
        }

        .text-base {
            font-size: 1rem;
            line-height: 1.5rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem
        }

        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem
        }

        .font-bold {
            font-weight: 700
        }

        .font-semibold {
            font-weight: 600
        }

        .uppercase {
            text-transform: uppercase
        }

        .italic {
            font-style: italic
        }

        .leading-relaxed {
            line-height: 1.625
        }

        .leading-tight {
            line-height: 1.25
        }

        .tracking-wider {
            letter-spacing: 0.05em
        }

        .text-blue-400 {
            --tw-text-opacity: 1;
            color: rgb(96 165 250 / var(--tw-text-opacity, 1))
        }

        .text-red-400 {
            --tw-text-opacity: 1;
            color: rgb(248 113 113 / var(--tw-text-opacity, 1))
        }

        .text-slate-200 {
            --tw-text-opacity: 1;
            color: rgb(226 232 240 / var(--tw-text-opacity, 1))
        }

        .text-slate-300 {
            --tw-text-opacity: 1;
            color: rgb(203 213 225 / var(--tw-text-opacity, 1))
        }

        .text-slate-400 {
            --tw-text-opacity: 1;
            color: rgb(148 163 184 / var(--tw-text-opacity, 1))
        }

        .text-slate-500 {
            --tw-text-opacity: 1;
            color: rgb(100 116 139 / var(--tw-text-opacity, 1))
        }

        .text-transparent {
            color: transparent
        }

        .text-white {
            --tw-text-opacity: 1;
            color: rgb(255 255 255 / var(--tw-text-opacity, 1))
        }

        .text-yellow-400 {
            --tw-text-opacity: 1;
            color: rgb(250 204 21 / var(--tw-text-opacity, 1))
        }

        .shadow-2xl {
            --tw-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .shadow-lg {
            --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .shadow-xl {
            --tw-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .shadow {
            --tw-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .backdrop-blur-lg {
            --tw-backdrop-blur: blur(16px);
            -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
            backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
        }

        .backdrop-blur-sm {
            --tw-backdrop-blur: blur(4px);
            -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
            backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
        }

        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms
        }

        .transition-colors {
            transition-property: color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms
        }

        .transition-transform {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms
        }

        .hover\:bg-emerald-500:hover {
            --tw-bg-opacity: 1;
            background-color: rgb(16 185 129 / var(--tw-bg-opacity, 1))
        }

        .hover\:bg-slate-600:hover {
            --tw-bg-opacity: 1;
            background-color: rgb(71 85 105 / var(--tw-bg-opacity, 1))
        }

        .hover\:bg-white\/5:hover {
            background-color: rgb(255 255 255 / 0.05)
        }

        .active\:cursor-grabbing:active {
            cursor: grabbing
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col overflow-hidden">
    <!-- Header / Title (Collapsible on Mobile) -->
    <header id="mobile-header" class="absolute top-0 left-0 w-full z-40 flex flex-col items-start transition-all duration-300" onclick="toggleHeader()">
        <!-- Mobile Toggle Indicator (Visible only on mobile) -->
        <div class="w-full flex justify-center pb-2 md:hidden">
            <div class="w-12 h-1 bg-slate-600 rounded-full"></div>
        </div>

        <div class="header-content w-full flex justify-between items-start pointer-events-none md:pointer-events-auto">
            <div class="pointer-events-auto max-w-lg">
                <!-- Back Button -->
                <a href="/"
                    class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-4 group">
                    <span
                        class="material-symbols-outlined group-hover:-translate-x-1 transition-transform">arrow_back</span>
                    <span class="font-bold tracking-wider text-sm">PARKLAND</span>
                </a>

                <h1
                    class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-rose-400 mb-2">
                    The Geometry of Representation
                </h1>
                <p class="text-slate-300 text-sm leading-relaxed mb-2">
                    Interactive 3D visualization of the <strong>2024 US Presidential Election</strong>.
                    <br>Height = <span class="text-yellow-400 font-semibold">Electoral Votes (EVs) per 1M Residents</span>.
                </p>
                <div class="text-[10px] text-slate-400 italic mb-4">
                    *EVs = Electoral Votes
                </div>

                <!-- Mobile Legend (Inside Header) -->
                <div class="mobile-only-legend md:hidden mb-2">
                    <div class="text-xs font-semibold text-slate-300 mb-1">Power Gradient</div>
                    <div class="h-2 w-full max-w-[200px] rounded-full gradient-legend mb-1"></div>
                    <div class="flex justify-between text-[10px] text-slate-500 font-mono w-full max-w-[200px]">
                        <span>Low Power</span>
                        <span>High Power</span>
                    </div>
                </div>
            </div>

            <!-- Controls (Desktop Only) -->
            <div class="pointer-events-auto controls-panel bg-slate-800/80 border border-slate-700/50 rounded-xl shadow-2xl w-64 collapsed-controls"
                id="controls-container" onclick="event.stopPropagation()">
                <!-- Header / Toggle -->
                <div class="flex items-center justify-between p-4 cursor-pointer hover:bg-white/5 transition-colors h-[56px]"
                    onclick="toggleControls()">
                    <span class="font-bold text-sm text-white flex items-center gap-2">
                        <span class="material-symbols-outlined text-base">tune</span> View Controls
                    </span>
                    <span class="material-symbols-outlined text-slate-400 transition-transform"
                        id="controls-icon">expand_more</span>
                </div>
                <!-- Collapsible Content -->
                <div class="px-4 pb-4 flex flex-col gap-4">
                    <div>
                        <label class="flex justify-between text-xs font-semibold text-slate-400 mb-2">
                            <span>Rotation (Y-Axis)</span>
                            <span class="material-symbols-outlined text-sm">360</span>
                        </label>
                        <input type="range" id="rot-z" min="0" max="360" value="0" class="w-full">
                    </div>
                    <div>
                        <label class="flex justify-between text-xs font-semibold text-slate-400 mb-2">
                            <span>Tilt (X-Axis)</span>
                            <span class="material-symbols-outlined text-sm">explore</span>
                        </label>
                        <input type="range" id="rot-x" min="0" max="85" value="55" class="w-full">
                    </div>
                    <button id="reset-view"
                        class="mt-2 bg-slate-700 hover:bg-slate-600 text-xs font-bold py-2 px-4 rounded border border-slate-600 transition-colors flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-sm">restart_alt</span> Reset View
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Legend (Bottom Left - Desktop Only) -->
    <div
        class="desktop-legend absolute bottom-6 left-6 z-40 pointer-events-auto bg-slate-900/80 border border-slate-700 rounded-xl p-4 backdrop-blur-sm w-56">
        <div class="text-xs font-semibold text-slate-300 mb-2">Power Gradient (EVs/1M Pop)</div>
        <div class="h-3 w-full rounded-full gradient-legend mb-1"></div>
        <div class="flex justify-between text-[10px] text-slate-500 font-mono">
            <span>Low Power</span>
            <span>High Power</span>
        </div>
    </div>

    <!-- Mobile Summary Trigger Button -->
    <button id="mobile-summary-trigger" onclick="toggleSummary()" class="fixed bottom-6 right-6 z-50 bg-blue-600 hover:bg-blue-500 text-white rounded-full p-4 shadow-2xl flex items-center justify-center transition-transform hover:scale-105 active:scale-95 hidden">
        <span class="material-symbols-outlined text-2xl">leaderboard</span>
    </button>

    <!-- Summary Table (Bottom Right Desktop / Bottom Sheet Mobile) -->
    <div id="summary-container" class="absolute bottom-6 right-6 z-40 pointer-events-auto">
        <div class="bg-slate-900/95 border border-slate-700 rounded-xl p-5 shadow-2xl backdrop-blur-lg h-full overflow-y-auto">
            <!-- Mobile Close Handle -->
            <div class="w-full flex justify-center pb-4 md:hidden" onclick="toggleSummary()">
                <div class="w-12 h-1 bg-slate-600 rounded-full"></div>
            </div>

            <h3 class="text-sm font-bold text-white mb-3 border-b border-slate-700 pb-2 flex items-center gap-2">
                <span class="material-symbols-outlined text-base text-yellow-400">leaderboard</span>
                Election Efficiency Summary
            </h3>
            <table class="w-full text-left summary-table border-collapse">
                <thead>
                    <tr>
                        <th class="pr-3">Candidate</th>
                        <th class="pr-3 text-right" title="Proportional Population Sum (State Pop * Vote %)">Pop. Rep.*
                        </th>
                        <th class="pr-3 text-right" title="Electoral Votes Won (Winner Take All)">EVs Won</th>
                        <th class="pr-3 text-right text-yellow-400" title="EVs Won divided by Pop. Rep (per Million)">
                            Efficiency</th>
                        <th class="text-right text-slate-300" title="Official Total Popular Vote">Total Votes**</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="text-blue-400 border-b border-slate-800/50">
                        <td class="py-2 font-bold flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-blue-500 inline-block"></span> Harris
                        </td>
                        <td class="text-right text-slate-300" id="sum-pop-dem">161.6M</td>
                        <td class="text-right text-lg" id="sum-ev-dem">226</td>
                        <td class="text-right text-yellow-400 font-bold" id="sum-pow-dem">1.40</td>
                        <td class="text-right text-slate-200 font-bold text-xs">75.02M</td>
                    </tr>
                    <tr class="text-red-400">
                        <td class="py-2 font-bold flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-red-500 inline-block"></span> Trump
                        </td>
                        <td class="text-right text-slate-300" id="sum-pop-rep">167.4M</td>
                        <td class="text-right text-lg" id="sum-ev-rep">312</td>
                        <td class="text-right text-yellow-400 font-bold" id="sum-pow-rep">1.86</td>
                        <td class="text-right text-slate-200 font-bold text-xs">77.30M</td>
                    </tr>
                </tbody>
            </table>
            <div class="mt-3 text-[10px] text-slate-500 text-right leading-tight space-y-1">
                <div>*Pop. Rep = Sum of (State Pop Ã— Vote %)</div>
                <div>Efficiency = EVs Won / (Pop. Rep in Millions)</div>
                <div>**Total Popular Vote from Certified 2024 Results</div>
            </div>
        </div>
    </div>

    <!-- Main 3D Stage -->
    <main id="stage" class="flex-grow relative flex items-center justify-center cursor-grab active:cursor-grabbing z-10"
        style="cursor: grab;">
        <div class="scene-container w-[800px] h-[600px]">
            <div id="world" class="world"
                style="transform: rotateX(55deg) rotateZ(30deg); transition: transform 0.1s linear;">
                <!-- The Grid Map will be injected here -->
                <div id="map-grid" class="map-grid">
                    <div class="state-cell group" style="grid-column-start: 1; grid-row-start: 1;">
                        <div class="bar" style="--height: 163.7107776261937px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(246, 104, 76)"></div>
                            <div class="face back" style="background-color: rgb(246, 104, 76)"></div>
                            <div class="face left" style="background-color: rgb(246, 104, 76)"></div>
                            <div class="face right" style="background-color: rgb(246, 104, 76)"></div>
                            <div class="face top" style="background-color: rgb(246, 104, 76)">
                                <span>AK</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 12; grid-row-start: 1;">
                        <div class="bar" style="--height: 114.28571428571429px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face back" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face left" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face right" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face top" style="background-color: rgb(193, 77, 168)">
                                <span>ME</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 11; grid-row-start: 2;">
                        <div class="bar" style="--height: 185.47140649149924px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(249, 149, 55)"></div>
                            <div class="face back" style="background-color: rgb(249, 149, 55)"></div>
                            <div class="face left" style="background-color: rgb(249, 149, 55)"></div>
                            <div class="face right" style="background-color: rgb(249, 149, 55)"></div>
                            <div class="face top" style="background-color: rgb(249, 149, 55)">
                                <span>VT</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 12; grid-row-start: 2;">
                        <div class="bar" style="--height: 114.28571428571429px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face back" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face left" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face right" style="background-color: rgb(193, 77, 168)"></div>
                            <div class="face top" style="background-color: rgb(193, 77, 168)">
                                <span>NH</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 2; grid-row-start: 3;">
                        <div class="bar" style="--height: 61.45966709346992px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(83, 119, 246)"></div>
                            <div class="face back" style="background-color: rgb(83, 119, 246)"></div>
                            <div class="face left" style="background-color: rgb(83, 119, 246)"></div>
                            <div class="face right" style="background-color: rgb(83, 119, 246)"></div>
                            <div class="face top" style="background-color: rgb(83, 119, 246)">
                                <span>WA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 3; grid-row-start: 3;">
                        <div class="bar" style="--height: 81.63265306122449px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(135, 94, 246)"></div>
                            <div class="face back" style="background-color: rgb(135, 94, 246)"></div>
                            <div class="face left" style="background-color: rgb(135, 94, 246)"></div>
                            <div class="face right" style="background-color: rgb(135, 94, 246)"></div>
                            <div class="face top" style="background-color: rgb(135, 94, 246)">
                                <span>ID</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 4; grid-row-start: 3;">
                        <div class="bar" style="--height: 141.59292035398232px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(239, 64, 101)"></div>
                            <div class="face back" style="background-color: rgb(239, 64, 101)"></div>
                            <div class="face left" style="background-color: rgb(239, 64, 101)"></div>
                            <div class="face right" style="background-color: rgb(239, 64, 101)"></div>
                            <div class="face top" style="background-color: rgb(239, 64, 101)">
                                <span>MT</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 3;">
                        <div class="bar" style="--height: 153.0612244897959px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(245, 81, 86)"></div>
                            <div class="face back" style="background-color: rgb(245, 81, 86)"></div>
                            <div class="face left" style="background-color: rgb(245, 81, 86)"></div>
                            <div class="face right" style="background-color: rgb(245, 81, 86)"></div>
                            <div class="face top" style="background-color: rgb(245, 81, 86)">
                                <span>ND</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 6; grid-row-start: 3;">
                        <div class="bar" style="--height: 69.80802792321116px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(104, 108, 246)"></div>
                            <div class="face back" style="background-color: rgb(104, 108, 246)"></div>
                            <div class="face left" style="background-color: rgb(104, 108, 246)"></div>
                            <div class="face right" style="background-color: rgb(104, 108, 246)"></div>
                            <div class="face top" style="background-color: rgb(104, 108, 246)">
                                <span>MN</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 7; grid-row-start: 3;">
                        <div class="bar" style="--height: 67.68189509306261px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(99, 111, 246)"></div>
                            <div class="face back" style="background-color: rgb(99, 111, 246)"></div>
                            <div class="face left" style="background-color: rgb(99, 111, 246)"></div>
                            <div class="face right" style="background-color: rgb(99, 111, 246)"></div>
                            <div class="face top" style="background-color: rgb(99, 111, 246)">
                                <span>WI</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 8; grid-row-start: 3;">
                        <div class="bar" style="--height: 59.82053838484546px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face back" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face left" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face right" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face top" style="background-color: rgb(78, 121, 246)">
                                <span>MI</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 10; grid-row-start: 3;">
                        <div class="bar" style="--height: 57.230454777721px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(71, 124, 246)"></div>
                            <div class="face back" style="background-color: rgb(71, 124, 246)"></div>
                            <div class="face left" style="background-color: rgb(71, 124, 246)"></div>
                            <div class="face right" style="background-color: rgb(71, 124, 246)"></div>
                            <div class="face top" style="background-color: rgb(71, 124, 246)">
                                <span>NY</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 11; grid-row-start: 3;">
                        <div class="bar" style="--height: 62.857142857142854px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(86, 117, 246)"></div>
                            <div class="face back" style="background-color: rgb(86, 117, 246)"></div>
                            <div class="face left" style="background-color: rgb(86, 117, 246)"></div>
                            <div class="face right" style="background-color: rgb(86, 117, 246)"></div>
                            <div class="face top" style="background-color: rgb(86, 117, 246)">
                                <span>MA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 12; grid-row-start: 3;">
                        <div class="bar" style="--height: 146.11872146118722px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(244, 67, 92)"></div>
                            <div class="face back" style="background-color: rgb(244, 67, 92)"></div>
                            <div class="face left" style="background-color: rgb(244, 67, 92)"></div>
                            <div class="face right" style="background-color: rgb(244, 67, 92)"></div>
                            <div class="face top" style="background-color: rgb(244, 67, 92)">
                                <span>RI</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 2; grid-row-start: 4;">
                        <div class="bar" style="--height: 75.65011820330969px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(120, 101, 246)"></div>
                            <div class="face back" style="background-color: rgb(120, 101, 246)"></div>
                            <div class="face left" style="background-color: rgb(120, 101, 246)"></div>
                            <div class="face right" style="background-color: rgb(120, 101, 246)"></div>
                            <div class="face top" style="background-color: rgb(120, 101, 246)">
                                <span>OR</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 3; grid-row-start: 4;">
                        <div class="bar" style="--height: 75.23510971786834px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(119, 102, 246)"></div>
                            <div class="face back" style="background-color: rgb(119, 102, 246)"></div>
                            <div class="face left" style="background-color: rgb(119, 102, 246)"></div>
                            <div class="face right" style="background-color: rgb(119, 102, 246)"></div>
                            <div class="face top" style="background-color: rgb(119, 102, 246)">
                                <span>NV</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 4; grid-row-start: 4;">
                        <div class="bar" style="--height: 205.47945205479454px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(251, 191, 36)"></div>
                            <div class="face back" style="background-color: rgb(251, 191, 36)"></div>
                            <div class="face left" style="background-color: rgb(251, 191, 36)"></div>
                            <div class="face right" style="background-color: rgb(251, 191, 36)"></div>
                            <div class="face top" style="background-color: rgb(251, 191, 36)">
                                <span>WY</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 4;">
                        <div class="bar" style="--height: 130.57671381936888px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(221, 69, 128)"></div>
                            <div class="face back" style="background-color: rgb(221, 69, 128)"></div>
                            <div class="face left" style="background-color: rgb(221, 69, 128)"></div>
                            <div class="face right" style="background-color: rgb(221, 69, 128)"></div>
                            <div class="face top" style="background-color: rgb(221, 69, 128)">
                                <span>SD</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 6; grid-row-start: 4;">
                        <div class="bar" style="--height: 75px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(118, 102, 246)"></div>
                            <div class="face back" style="background-color: rgb(118, 102, 246)"></div>
                            <div class="face left" style="background-color: rgb(118, 102, 246)"></div>
                            <div class="face right" style="background-color: rgb(118, 102, 246)"></div>
                            <div class="face top" style="background-color: rgb(118, 102, 246)">
                                <span>IA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 7; grid-row-start: 4;">
                        <div class="bar" style="--height: 60.606060606060616px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(80, 120, 246)"></div>
                            <div class="face back" style="background-color: rgb(80, 120, 246)"></div>
                            <div class="face left" style="background-color: rgb(80, 120, 246)"></div>
                            <div class="face right" style="background-color: rgb(80, 120, 246)"></div>
                            <div class="face top" style="background-color: rgb(80, 120, 246)">
                                <span>IL</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 8; grid-row-start: 4;">
                        <div class="bar" style="--height: 64.1399416909621px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(90, 115, 246)"></div>
                            <div class="face back" style="background-color: rgb(90, 115, 246)"></div>
                            <div class="face left" style="background-color: rgb(90, 115, 246)"></div>
                            <div class="face right" style="background-color: rgb(90, 115, 246)"></div>
                            <div class="face top" style="background-color: rgb(90, 115, 246)">
                                <span>IN</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 9; grid-row-start: 4;">
                        <div class="bar" style="--height: 57.72495755517827px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(73, 123, 246)"></div>
                            <div class="face back" style="background-color: rgb(73, 123, 246)"></div>
                            <div class="face left" style="background-color: rgb(73, 123, 246)"></div>
                            <div class="face right" style="background-color: rgb(73, 123, 246)"></div>
                            <div class="face top" style="background-color: rgb(73, 123, 246)">
                                <span>OH</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 10; grid-row-start: 4;">
                        <div class="bar" style="--height: 58.64197530864197px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(75, 122, 246)"></div>
                            <div class="face back" style="background-color: rgb(75, 122, 246)"></div>
                            <div class="face left" style="background-color: rgb(75, 122, 246)"></div>
                            <div class="face right" style="background-color: rgb(75, 122, 246)"></div>
                            <div class="face top" style="background-color: rgb(75, 122, 246)">
                                <span>PA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 11; grid-row-start: 4;">
                        <div class="bar" style="--height: 60.27987082884823px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(79, 120, 246)"></div>
                            <div class="face back" style="background-color: rgb(79, 120, 246)"></div>
                            <div class="face left" style="background-color: rgb(79, 120, 246)"></div>
                            <div class="face right" style="background-color: rgb(79, 120, 246)"></div>
                            <div class="face top" style="background-color: rgb(79, 120, 246)">
                                <span>NJ</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 12; grid-row-start: 4;">
                        <div class="bar" style="--height: 77.34806629834254px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(124, 99, 246)"></div>
                            <div class="face back" style="background-color: rgb(124, 99, 246)"></div>
                            <div class="face left" style="background-color: rgb(124, 99, 246)"></div>
                            <div class="face right" style="background-color: rgb(124, 99, 246)"></div>
                            <div class="face top" style="background-color: rgb(124, 99, 246)">
                                <span>CT</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 1; grid-row-start: 5;">
                        <div class="bar" style="--height: 55.44147843942505px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(67, 126, 246)"></div>
                            <div class="face back" style="background-color: rgb(67, 126, 246)"></div>
                            <div class="face left" style="background-color: rgb(67, 126, 246)"></div>
                            <div class="face right" style="background-color: rgb(67, 126, 246)"></div>
                            <div class="face top" style="background-color: rgb(67, 126, 246)">
                                <span>CA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 3; grid-row-start: 5;">
                        <div class="bar" style="--height: 70.38123167155425px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(106, 108, 246)"></div>
                            <div class="face back" style="background-color: rgb(106, 108, 246)"></div>
                            <div class="face left" style="background-color: rgb(106, 108, 246)"></div>
                            <div class="face right" style="background-color: rgb(106, 108, 246)"></div>
                            <div class="face top" style="background-color: rgb(106, 108, 246)">
                                <span>UT</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 4; grid-row-start: 5;">
                        <div class="bar" style="--height: 68.14310051107326px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(100, 111, 246)"></div>
                            <div class="face back" style="background-color: rgb(100, 111, 246)"></div>
                            <div class="face left" style="background-color: rgb(100, 111, 246)"></div>
                            <div class="face right" style="background-color: rgb(100, 111, 246)"></div>
                            <div class="face top" style="background-color: rgb(100, 111, 246)">
                                <span>CO</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 5;">
                        <div class="bar" style="--height: 101.01010101010101px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(170, 83, 201)"></div>
                            <div class="face back" style="background-color: rgb(170, 83, 201)"></div>
                            <div class="face left" style="background-color: rgb(170, 83, 201)"></div>
                            <div class="face right" style="background-color: rgb(170, 83, 201)"></div>
                            <div class="face top" style="background-color: rgb(170, 83, 201)">
                                <span>NE</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 6; grid-row-start: 5;">
                        <div class="bar" style="--height: 64.62035541195476px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face back" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face left" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face right" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face top" style="background-color: rgb(91, 115, 246)">
                                <span>MO</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 7; grid-row-start: 5;">
                        <div class="bar" style="--height: 70.79646017699116px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(107, 107, 246)"></div>
                            <div class="face back" style="background-color: rgb(107, 107, 246)"></div>
                            <div class="face left" style="background-color: rgb(107, 107, 246)"></div>
                            <div class="face right" style="background-color: rgb(107, 107, 246)"></div>
                            <div class="face top" style="background-color: rgb(107, 107, 246)">
                                <span>KY</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 8; grid-row-start: 5;">
                        <div class="bar" style="--height: 90.3954802259887px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(152, 89, 228)"></div>
                            <div class="face back" style="background-color: rgb(152, 89, 228)"></div>
                            <div class="face left" style="background-color: rgb(152, 89, 228)"></div>
                            <div class="face right" style="background-color: rgb(152, 89, 228)"></div>
                            <div class="face top" style="background-color: rgb(152, 89, 228)">
                                <span>WV</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 9; grid-row-start: 5;">
                        <div class="bar" style="--height: 59.70149253731343px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face back" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face left" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face right" style="background-color: rgb(78, 121, 246)"></div>
                            <div class="face top" style="background-color: rgb(78, 121, 246)">
                                <span>VA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 10; grid-row-start: 5;">
                        <div class="bar" style="--height: 64.72491909385114px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face back" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face left" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face right" style="background-color: rgb(91, 115, 246)"></div>
                            <div class="face top" style="background-color: rgb(91, 115, 246)">
                                <span>MD</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 11; grid-row-start: 5;">
                        <div class="bar" style="--height: 176.99115044247787px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(248, 131, 63)"></div>
                            <div class="face back" style="background-color: rgb(248, 131, 63)"></div>
                            <div class="face left" style="background-color: rgb(248, 131, 63)"></div>
                            <div class="face right" style="background-color: rgb(248, 131, 63)"></div>
                            <div class="face top" style="background-color: rgb(248, 131, 63)">
                                <span>DC</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 12; grid-row-start: 5;">
                        <div class="bar" style="--height: 116.50485436893204px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(196, 76, 163)"></div>
                            <div class="face back" style="background-color: rgb(196, 76, 163)"></div>
                            <div class="face left" style="background-color: rgb(196, 76, 163)"></div>
                            <div class="face right" style="background-color: rgb(196, 76, 163)"></div>
                            <div class="face top" style="background-color: rgb(196, 76, 163)">
                                <span>DE</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 3; grid-row-start: 6;">
                        <div class="bar" style="--height: 59.219380888290715px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(77, 122, 246)"></div>
                            <div class="face back" style="background-color: rgb(77, 122, 246)"></div>
                            <div class="face left" style="background-color: rgb(77, 122, 246)"></div>
                            <div class="face right" style="background-color: rgb(77, 122, 246)"></div>
                            <div class="face top" style="background-color: rgb(77, 122, 246)">
                                <span>AZ</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 4; grid-row-start: 6;">
                        <div class="bar" style="--height: 94.7867298578199px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(159, 86, 217)"></div>
                            <div class="face back" style="background-color: rgb(159, 86, 217)"></div>
                            <div class="face left" style="background-color: rgb(159, 86, 217)"></div>
                            <div class="face right" style="background-color: rgb(159, 86, 217)"></div>
                            <div class="face top" style="background-color: rgb(159, 86, 217)">
                                <span>NM</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 6;">
                        <div class="bar" style="--height: 81.91126279863481px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face back" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face left" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face right" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face top" style="background-color: rgb(136, 93, 246)">
                                <span>KS</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 6; grid-row-start: 6;">
                        <div class="bar" style="--height: 78.4313725490196px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(127, 98, 246)"></div>
                            <div class="face back" style="background-color: rgb(127, 98, 246)"></div>
                            <div class="face left" style="background-color: rgb(127, 98, 246)"></div>
                            <div class="face right" style="background-color: rgb(127, 98, 246)"></div>
                            <div class="face top" style="background-color: rgb(127, 98, 246)">
                                <span>AR</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 7; grid-row-start: 6;">
                        <div class="bar" style="--height: 61.79775280898876px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(83, 118, 246)"></div>
                            <div class="face back" style="background-color: rgb(83, 118, 246)"></div>
                            <div class="face left" style="background-color: rgb(83, 118, 246)"></div>
                            <div class="face right" style="background-color: rgb(83, 118, 246)"></div>
                            <div class="face top" style="background-color: rgb(83, 118, 246)">
                                <span>TN</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 8; grid-row-start: 6;">
                        <div class="bar" style="--height: 59.095106186518926px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(76, 122, 246)"></div>
                            <div class="face back" style="background-color: rgb(76, 122, 246)"></div>
                            <div class="face left" style="background-color: rgb(76, 122, 246)"></div>
                            <div class="face right" style="background-color: rgb(76, 122, 246)"></div>
                            <div class="face top" style="background-color: rgb(76, 122, 246)">
                                <span>NC</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 9; grid-row-start: 6;">
                        <div class="bar" style="--height: 67.0391061452514px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(97, 112, 246)"></div>
                            <div class="face back" style="background-color: rgb(97, 112, 246)"></div>
                            <div class="face left" style="background-color: rgb(97, 112, 246)"></div>
                            <div class="face right" style="background-color: rgb(97, 112, 246)"></div>
                            <div class="face top" style="background-color: rgb(97, 112, 246)">
                                <span>SC</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 7;">
                        <div class="bar" style="--height: 69.13580246913581px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(103, 109, 246)"></div>
                            <div class="face back" style="background-color: rgb(103, 109, 246)"></div>
                            <div class="face left" style="background-color: rgb(103, 109, 246)"></div>
                            <div class="face right" style="background-color: rgb(103, 109, 246)"></div>
                            <div class="face top" style="background-color: rgb(103, 109, 246)">
                                <span>OK</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 6; grid-row-start: 7;">
                        <div class="bar" style="--height: 70.02188183807439px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(105, 108, 246)"></div>
                            <div class="face back" style="background-color: rgb(105, 108, 246)"></div>
                            <div class="face left" style="background-color: rgb(105, 108, 246)"></div>
                            <div class="face right" style="background-color: rgb(105, 108, 246)"></div>
                            <div class="face top" style="background-color: rgb(105, 108, 246)">
                                <span>LA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 7; grid-row-start: 7;">
                        <div class="bar" style="--height: 81.91126279863481px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face back" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face left" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face right" style="background-color: rgb(136, 93, 246)"></div>
                            <div class="face top" style="background-color: rgb(136, 93, 246)">
                                <span>MS</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 8; grid-row-start: 7;">
                        <div class="bar" style="--height: 70.58823529411765px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(106, 107, 246)"></div>
                            <div class="face back" style="background-color: rgb(106, 107, 246)"></div>
                            <div class="face left" style="background-color: rgb(106, 107, 246)"></div>
                            <div class="face right" style="background-color: rgb(106, 107, 246)"></div>
                            <div class="face top" style="background-color: rgb(106, 107, 246)">
                                <span>AL</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 9; grid-row-start: 7;">
                        <div class="bar" style="--height: 58.076225045372055px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(74, 123, 246)"></div>
                            <div class="face back" style="background-color: rgb(74, 123, 246)"></div>
                            <div class="face left" style="background-color: rgb(74, 123, 246)"></div>
                            <div class="face right" style="background-color: rgb(74, 123, 246)"></div>
                            <div class="face top" style="background-color: rgb(74, 123, 246)">
                                <span>GA</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 1; grid-row-start: 8;">
                        <div class="bar" style="--height: 111.8881118881119px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(188, 78, 174)"></div>
                            <div class="face back" style="background-color: rgb(188, 78, 174)"></div>
                            <div class="face left" style="background-color: rgb(188, 78, 174)"></div>
                            <div class="face right" style="background-color: rgb(188, 78, 174)"></div>
                            <div class="face top" style="background-color: rgb(188, 78, 174)">
                                <span>HI</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 5; grid-row-start: 8;">
                        <div class="bar" style="--height: 52.45901639344262px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(59, 130, 246)"></div>
                            <div class="face back" style="background-color: rgb(59, 130, 246)"></div>
                            <div class="face left" style="background-color: rgb(59, 130, 246)"></div>
                            <div class="face right" style="background-color: rgb(59, 130, 246)"></div>
                            <div class="face top" style="background-color: rgb(59, 130, 246)">
                                <span>TX</span>
                            </div>
                        </div>
                    </div>
                    <div class="state-cell group" style="grid-column-start: 10; grid-row-start: 8;">
                        <div class="bar" style="--height: 53.073861123396725px;">
                            <div class="shadow"></div>
                            <div class="face front" style="background-color: rgb(61, 129, 246)"></div>
                            <div class="face back" style="background-color: rgb(61, 129, 246)"></div>
                            <div class="face left" style="background-color: rgb(61, 129, 246)"></div>
                            <div class="face right" style="background-color: rgb(61, 129, 246)"></div>
                            <div class="face top" style="background-color: rgb(61, 129, 246)">
                                <span>FL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Instructions Overlay -->
    <div id="hint"
        class="absolute bottom-10 left-1/2 -translate-x-1/2 text-slate-500 text-sm animate-pulse pointer-events-none z-0">
        Click &amp; Drag to Rotate
    </div>

    <!-- Tooltip Element -->
    <div id="tooltip"
        class="fixed hidden bg-slate-900/95 border border-slate-600 p-3 rounded-lg shadow-xl text-sm pointer-events-none min-w-[180px]">
        <div class="flex justify-between items-baseline mb-2 border-b border-slate-600 pb-1">
            <span class="font-bold text-white text-lg" id="tt-state">State</span>
            <span class="font-mono text-xs text-slate-400" id="tt-id">ID</span>
        </div>
        <!-- Mini Vote Chart -->
        <div class="mb-3">
            <div class="flex justify-between text-[10px] text-slate-400 mb-1 uppercase tracking-wider font-bold">
                <span>Harris</span>
                <span>Trump</span>
            </div>
            <div class="vote-bar-bg h-2 mb-1">
                <div id="tt-bar-dem" class="vote-bar-dem"></div>
                <div id="tt-bar-oth" class="vote-bar-oth"></div>
                <div id="tt-bar-rep" class="vote-bar-rep"></div>
            </div>
            <div class="flex justify-between text-xs font-mono font-bold text-white">
                <span class="text-blue-400" id="tt-pct-dem"></span>
                <span class="text-red-400" id="tt-pct-rep"></span>
            </div>
        </div>
        <div class="space-y-1 text-xs">
            <div class="flex justify-between text-slate-300"><span>Pop:</span> <span class="text-white font-mono"
                    id="tt-pop"></span></div>
            <div class="flex justify-between text-slate-300"><span>EVs:</span> <span class="text-white font-mono"
                    id="tt-ev"></span></div>
            <div class="mt-2 pt-2 border-t border-slate-700 flex justify-between items-center">
                <span class="text-yellow-400 font-bold text-[10px] uppercase">Power Index:</span>
                <span class="text-yellow-400 font-mono font-bold" id="tt-ratio"></span>
            </div>
            <div class="text-[10px] text-right text-slate-500">EVs per 1M residents</div>
        </div>
    </div>

    <script>
        /* 
         * DATA SOURCES:
         * Electoral Votes: 2024 Allocation
         * Population: 2023/2024 Estimates
         * 2024 Election Results: Certified Data
         */
        const states = [
            // Row 0 (Top)
            { id: "AK", name: "Alaska", r: 0, c: 0, ev: 3, pop: 733000, h: 41.4, t: 54.5 },
            { id: "ME", name: "Maine", r: 0, c: 11, ev: 4, pop: 1400000, h: 52.0, t: 45.0 },
            // Row 1
            { id: "VT", name: "Vermont", r: 1, c: 10, ev: 3, pop: 647000, h: 64.4, t: 32.6 },
            { id: "NH", name: "New Hampshire", r: 1, c: 11, ev: 4, pop: 1400000, h: 50.9, t: 48.1 },
            // Row 2
            { id: "WA", name: "Washington", r: 2, c: 1, ev: 12, pop: 7810000, h: 57.6, t: 39.3 },
            { id: "ID", name: "Idaho", r: 2, c: 2, ev: 4, pop: 1960000, h: 30.4, t: 66.9 },
            { id: "MT", name: "Montana", r: 2, c: 3, ev: 4, pop: 1130000, h: 38.5, t: 58.4 },
            { id: "ND", name: "North Dakota", r: 2, c: 4, ev: 3, pop: 784000, h: 30.0, t: 67.0 },
            { id: "MN", name: "Minnesota", r: 2, c: 5, ev: 10, pop: 5730000, h: 51.1, t: 46.9 },
            { id: "WI", name: "Wisconsin", r: 2, c: 6, ev: 10, pop: 5910000, h: 48.9, t: 49.7 },
            { id: "MI", name: "Michigan", r: 2, c: 7, ev: 15, pop: 10030000, h: 48.3, t: 49.7 },
            { id: "NY", name: "New York", r: 2, c: 9, ev: 28, pop: 19570000, h: 55.9, t: 43.3 },
            { id: "MA", name: "Massachusetts", r: 2, c: 10, ev: 11, pop: 7000000, h: 61.3, t: 36.5 },
            { id: "RI", name: "Rhode Island", r: 2, c: 11, ev: 4, pop: 1095000, h: 55.5, t: 42.0 },
            // Row 3
            { id: "OR", name: "Oregon", r: 3, c: 1, ev: 8, pop: 4230000, h: 56.0, t: 42.0 },
            { id: "NV", name: "Nevada", r: 3, c: 2, ev: 6, pop: 3190000, h: 47.5, t: 50.6 },
            { id: "WY", name: "Wyoming", r: 3, c: 3, ev: 3, pop: 584000, h: 26.0, t: 72.0 },
            { id: "SD", name: "South Dakota", r: 3, c: 4, ev: 3, pop: 919000, h: 34.2, t: 63.4 },
            { id: "IA", name: "Iowa", r: 3, c: 5, ev: 6, pop: 3200000, h: 42.7, t: 56.0 },
            { id: "IL", name: "Illinois", r: 3, c: 6, ev: 19, pop: 12540000, h: 54.8, t: 43.8 },
            { id: "IN", name: "Indiana", r: 3, c: 7, ev: 11, pop: 6860000, h: 39.7, t: 58.6 },
            { id: "OH", name: "Ohio", r: 3, c: 8, ev: 17, pop: 11780000, h: 43.9, t: 55.2 },
            { id: "PA", name: "Pennsylvania", r: 3, c: 9, ev: 19, pop: 12960000, h: 48.7, t: 50.4 },
            { id: "NJ", name: "New Jersey", r: 3, c: 10, ev: 14, pop: 9290000, h: 52.0, t: 46.1 },
            { id: "CT", name: "Connecticut", r: 3, c: 11, ev: 7, pop: 3620000, h: 56.4, t: 41.9 },
            // Row 4
            { id: "CA", name: "California", r: 4, c: 0, ev: 54, pop: 38960000, h: 58.5, t: 38.3 },
            { id: "UT", name: "Utah", r: 4, c: 2, ev: 6, pop: 3410000, h: 37.8, t: 59.4 },
            { id: "CO", name: "Colorado", r: 4, c: 3, ev: 10, pop: 5870000, h: 54.2, t: 43.2 },
            { id: "NE", name: "Nebraska", r: 4, c: 4, ev: 5, pop: 1980000, h: 38.5, t: 59.5 },
            { id: "MO", name: "Missouri", r: 4, c: 5, ev: 10, pop: 6190000, h: 40.1, t: 58.5 },
            { id: "KY", name: "Kentucky", r: 4, c: 6, ev: 8, pop: 4520000, h: 33.9, t: 64.6 },
            { id: "WV", name: "West Virginia", r: 4, c: 7, ev: 4, pop: 1770000, h: 28.1, t: 70.0 },
            { id: "VA", name: "Virginia", r: 4, c: 8, ev: 13, pop: 8710000, h: 51.8, t: 46.6 },
            { id: "MD", name: "Maryland", r: 4, c: 9, ev: 10, pop: 6180000, h: 63.0, t: 34.4 },
            { id: "DC", name: "District of Columbia", r: 4, c: 10, ev: 3, pop: 678000, h: 92.5, t: 6.6 },
            { id: "DE", name: "Delaware", r: 4, c: 11, ev: 3, pop: 1030000, h: 56.6, t: 41.9 },
            // Row 5
            { id: "AZ", name: "Arizona", r: 5, c: 2, ev: 11, pop: 7430000, h: 46.7, t: 52.2 },
            { id: "NM", name: "New Mexico", r: 5, c: 3, ev: 5, pop: 2110000, h: 51.2, t: 45.8 },
            { id: "KS", name: "Kansas", r: 5, c: 4, ev: 6, pop: 2930000, h: 41.0, t: 57.2 },
            { id: "AR", name: "Arkansas", r: 5, c: 5, ev: 6, pop: 3060000, h: 33.5, t: 64.2 },
            { id: "TN", name: "Tennessee", r: 5, c: 6, ev: 11, pop: 7120000, h: 34.5, t: 64.2 },
            { id: "NC", name: "North Carolina", r: 5, c: 7, ev: 16, pop: 10830000, h: 47.8, t: 51.0 },
            { id: "SC", name: "South Carolina", r: 5, c: 8, ev: 9, pop: 5370000, h: 40.4, t: 58.2 },
            // Row 6
            { id: "OK", name: "Oklahoma", r: 6, c: 4, ev: 7, pop: 4050000, h: 31.9, t: 66.2 },
            { id: "LA", name: "Louisiana", r: 6, c: 5, ev: 8, pop: 4570000, h: 38.2, t: 60.2 },
            { id: "MS", name: "Mississippi", r: 6, c: 6, ev: 6, pop: 2930000, h: 37.3, t: 61.6 },
            { id: "AL", name: "Alabama", r: 6, c: 7, ev: 9, pop: 5100000, h: 34.2, t: 64.8 },
            { id: "GA", name: "Georgia", r: 6, c: 8, ev: 16, pop: 11020000, h: 48.5, t: 50.7 },
            // Row 7
            { id: "HI", name: "Hawaii", r: 7, c: 0, ev: 4, pop: 1430000, h: 60.6, t: 37.5 },
            { id: "TX", name: "Texas", r: 7, c: 4, ev: 40, pop: 30500000, h: 42.4, t: 56.3 },
            { id: "FL", name: "Florida", r: 7, c: 9, ev: 30, pop: 22610000, h: 43.0, t: 56.1 },
        ];

        // Initialize Map
        const grid = document.getElementById('map-grid');
        const world = document.getElementById('world');
        const stage = document.getElementById('stage');
        const tooltip = document.getElementById('tooltip');

        // Calculation and Color Scale logic
        let minRatio = Infinity;
        let maxRatio = -Infinity;

        // Metric Objects
        let summary = {
            dem: { pop_rep: 0, ev: 0 },
            rep: { pop_rep: 0, ev: 0 }
        };

        // 1. Calculate Stats
        states.forEach(s => {
            // Individual State Power Ratio (For Visualization)
            s.ratio = s.ev / (s.pop / 1000000);
            if (s.ratio < minRatio) minRatio = s.ratio;
            if (s.ratio > maxRatio) maxRatio = s.ratio;

            // Calculate Other % for Tooltip
            s.o = (100 - s.h - s.t).toFixed(1);

            // A. Proportional Population ("Population Representation")
            // Formula: State Pop * (Candidate % / 100)
            summary.dem.pop_rep += s.pop * (s.h / 100);
            summary.rep.pop_rep += s.pop * (s.t / 100);

            // B. Winner Take All EVs
            if (s.h > s.t) {
                summary.dem.ev += s.ev;
            } else {
                summary.rep.ev += s.ev;
            }
        });

        // Update Summary Table
        function updateSummaryTable() {
            // Display Pop Rep in Millions
            document.getElementById('sum-pop-dem').textContent = (summary.dem.pop_rep / 1000000).toFixed(1) + 'M';
            document.getElementById('sum-ev-dem').textContent = summary.dem.ev;

            // Calculate Efficiency (Average Power)
            // Formula: Total EVs Won / (Total Pop Rep / 1,000,000)
            const effDem = summary.dem.ev / (summary.dem.pop_rep / 1000000);
            document.getElementById('sum-pow-dem').textContent = effDem.toFixed(2);

            document.getElementById('sum-pop-rep').textContent = (summary.rep.pop_rep / 1000000).toFixed(1) + 'M';
            document.getElementById('sum-ev-rep').textContent = summary.rep.ev;

            const effRep = summary.rep.ev / (summary.rep.pop_rep / 1000000);
            document.getElementById('sum-pow-rep').textContent = effRep.toFixed(2);
        }
        updateSummaryTable();

        // Color Interpolation (Power Map)
        function getColor(value) {
            const t = (value - minRatio) / (maxRatio - minRatio);
            if (t < 0.2) return `rgb(${interpolate(59, 130, 246, 139, 92, 246, t / 0.2)})`;
            if (t < 0.6) return `rgb(${interpolate(139, 92, 246, 244, 63, 94, (t - 0.2) / 0.4)})`;
            return `rgb(${interpolate(244, 63, 94, 251, 191, 36, (t - 0.6) / 0.4)})`;
        }

        function interpolate(r1, g1, b1, r2, g2, b2, factor) {
            const r = Math.round(r1 + (r2 - r1) * factor);
            const g = Math.round(g1 + (g2 - g1) * factor);
            const b = Math.round(b1 + (b2 - b1) * factor);
            return `${r}, ${g}, ${b}`;
        }

        // 2. Render Grid (Boxes)
        states.forEach(s => {
            const cell = document.createElement('div');
            cell.className = 'state-cell group';
            cell.style.gridColumnStart = s.c + 1;
            cell.style.gridRowStart = s.r + 1;

            const heightScale = 40;
            const zHeight = Math.max(10, (s.ratio * heightScale));
            const color = getColor(s.ratio);

            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.setProperty('--height', `${zHeight}px`);

            bar.innerHTML = `
                <div class="shadow"></div>
                <div class="face front" style="background-color: ${color}"></div>
                <div class="face back" style="background-color: ${color}"></div>
                <div class="face left" style="background-color: ${color}"></div>
                <div class="face right" style="background-color: ${color}"></div>
                <div class="face top" style="background-color: ${color}">
                    <span>${s.id}</span>
                </div>
            `;

            cell.appendChild(bar);
            grid.appendChild(cell);

            cell.addEventListener('mousemove', (e) => moveTooltip(e, s));
            cell.addEventListener('mouseleave', hideTooltip);
        });

        // Tooltip Logic
        function moveTooltip(e, s) {
            tooltip.style.display = 'block';
            tooltip.style.left = e.clientX + 20 + 'px';
            tooltip.style.top = e.clientY + 20 + 'px';
            tooltip.style.opacity = 1;

            document.getElementById('tt-state').textContent = s.name;
            document.getElementById('tt-id').textContent = s.id;
            document.getElementById('tt-pop').textContent = (s.pop / 1000000).toFixed(2) + 'M';
            document.getElementById('tt-ev').textContent = s.ev;
            document.getElementById('tt-ratio').textContent = s.ratio.toFixed(2);

            document.getElementById('tt-bar-dem').style.width = s.h + '%';
            document.getElementById('tt-bar-rep').style.width = s.t + '%';
            document.getElementById('tt-bar-oth').style.width = s.o + '%';

            document.getElementById('tt-pct-dem').textContent = s.h + '%';
            document.getElementById('tt-pct-rep').textContent = s.t + '%';
        }

        function hideTooltip() {
            tooltip.style.opacity = 0;
        }

        // 3. Interaction Logic
        let isDragging = false;
        let startX, startY;
        let rotX = 55;
        let rotZ = 0;

        const rotXInput = document.getElementById('rot-x');
        const rotZInput = document.getElementById('rot-z');
        const resetBtn = document.getElementById('reset-view');

        function updateTransform() {
            world.style.transform = `rotateX(${rotX}deg) rotateZ(${rotZ}deg)`;
            rotXInput.value = rotX;
            rotZInput.value = (rotZ % 360 + 360) % 360;
        }

        updateTransform();

        stage.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            stage.style.cursor = 'grabbing';
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            stage.style.cursor = 'grab';
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            // REVERSED Tilt Logic
            rotZ -= deltaX * 0.5;
            rotX -= deltaY * 0.5;

            if (rotX < 0) rotX = 0;
            if (rotX > 85) rotX = 85;

            startX = e.clientX;
            startY = e.clientY;
            updateTransform();
        });

        rotXInput.addEventListener('input', (e) => { rotX = parseInt(e.target.value); updateTransform(); });
        rotZInput.addEventListener('input', (e) => { rotZ = parseInt(e.target.value); updateTransform(); });
        resetBtn.addEventListener('click', () => { rotX = 55; rotZ = 0; updateTransform(); });

        // Toggle Controls Logic
        const controlsContainer = document.getElementById('controls-container');
        const controlsIcon = document.getElementById('controls-icon');
        let isControlsExpanded = false;

        function toggleControls() {
            isControlsExpanded = !isControlsExpanded;
            if (isControlsExpanded) {
                controlsContainer.classList.remove('collapsed-controls');
                controlsContainer.style.height = 'auto';
                controlsIcon.style.transform = 'rotate(180deg)';
            } else {
                controlsContainer.classList.add('collapsed-controls');
                controlsContainer.style.height = '56px';
                controlsIcon.style.transform = 'rotate(0deg)';
            }
        }

        // Intro Spin
        setTimeout(() => {
            world.style.transition = 'transform 1.5s ease-out';
            rotZ = 30;
            updateTransform();
            setTimeout(() => { world.style.transition = 'transform 0.1s linear'; }, 1500);
        }, 500);


        // --- FLASK PROJECT DOWNLOAD LOGIC ---

        function downloadFile(filename, content) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function downloadFlaskProject() {
            // 1. Generate app.py
            const appPyContent =
                `from flask import Flask, render_template

app = Flask(__name__)

@app.route('/')
def home():
    return render_template('index.html')

if __name__ == '__main__':
    app.run(debug=True)`;

            downloadFile('app.py', appPyContent);

            // 2. Generate requirements.txt
            downloadFile('requirements.txt', 'Flask\n');

            // 3. Generate Cleaned index.html
            // We clone the current document to avoid modifying the active page
            const clone = document.documentElement.cloneNode(true);

            // Remove the download button UI from the cloned version
            // (Users who download the hosted version don't need to see "Download Source Code" again)
            const downloadUI = clone.querySelector('#download-ui');
            if (downloadUI) {
                downloadUI.remove();
            }

            // Serialize the HTML
            const htmlContent = "<!DOCTYPE html>\n" + clone.outerHTML;
            downloadFile('index.html', htmlContent);

            // Instructions
            setTimeout(() => {
                alert("Download Complete!\n\n1. Move 'index.html' into a folder named 'templates'.\n2. Keep 'app.py' and 'requirements.txt' in the root folder.\n3. Run 'pip install -r requirements.txt' then 'python app.py'.");
            }, 500);
        }

    </script>


    <script>
        // Mobile Header Toggle
        function toggleHeader() {
            if (window.innerWidth > 850) return; // Only for mobile
            const header = document.getElementById('mobile-header');
            header.classList.toggle('collapsed');
        }

        // Mobile Summary Toggle
        function toggleSummary() {
            const container = document.getElementById('summary-container');
            container.classList.toggle('open');
        }

        // Initialize Header as Collapsed on Mobile
        document.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth <= 850) {
                const header = document.getElementById('mobile-header');
                if (header) header.classList.add('collapsed');
            }
        });
    </script>
</body>

</html>